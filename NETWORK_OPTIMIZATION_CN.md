# 面向中国用户的网络优化指南

本指南总结了参考海外互联网公司的实践，在 Vercel 和 MongoDB Atlas 部署在美国的情况下，优化中国大陆用户访问体验的措施。

## 1. 利用 CDN 提升静态资源访问速度

- **Vercel Edge Network**：确保静态资源部署在 Vercel 的全球 CDN，利用其在香港、新加坡等节点为中国用户加速。
- **国内 CDN**：根据需要接入 Cloudflare、阿里云 CDN 或腾讯云 CDN，在国内节点缓存静态文件。

## 2. 数据库就近读写

- 开启 **MongoDB Atlas Global Clusters** 或在亚洲区域（如香港、新加坡）建立只读副本。这样读取操作可以在更靠近用户的区域完成。
- 配置 `readPreference: 'secondaryPreferred'`，让应用优先从就近的副本读取数据。

## 3. 前端缓存策略

- 使用 **Service Worker** 对静态资源和接口响应进行离线缓存，减少重复网络请求。
- 设置 `Cache-Control`、`ETag` 等 HTTP 头部，让浏览器根据文件是否变更进行缓存命中判断。

## 4. 服务端缓存和压缩

- 已在项目中使用 **NodeCache** 实现 API 级别的 5 分钟内存缓存，可根据访问量调整过期时间并定期清理。
- 启用 **gzip/deflate** 压缩中间件，减小响应体积。

## 5. 利用边缘函数处理动态请求

- 在 Vercel 上使用 **Edge Functions** 将部分 API 逻辑下沉到边缘节点，减小跨国网络延迟。
- 对无需频繁访问数据库的接口，可在边缘直接返回缓存数据。

## 6. 监控与持续优化

- 通过 `app.use((req, res, next) => {...})` 在服务端记录每个接口的耗时，分析瓶颈。
- 观察 NodeCache 的命中率以及 CDN 后台统计，逐步调整缓存策略。
- 收集中国用户的加载时间和错误率，及时修复访问中的问题。

以上措施可以有效减少中国用户访问时的等待时间，提升整体体验。
