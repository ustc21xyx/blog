# 角色数据爬取和管理系统

## 🎯 概述

将萌娘百科角色数据批量爬取并存储到MongoDB数据库中，替代不稳定的实时爬取。

## 🚀 使用方法

### 1. 运行爬虫脚本
```bash
cd /Users/crush/code/claude_test/blog/server

# 运行爬虫，批量获取角色数据
npm run crawl-characters
```

### 2. 使用新的API接口

#### 获取随机角色（数据库版本）
```bash
curl http://localhost:5000/api/character/random-db
```

#### 获取热门角色列表
```bash
curl http://localhost:5000/api/character/popular?limit=10
```

#### 搜索角色
```bash
curl "http://localhost:5000/api/character/search?q=初音"
```

## 📊 数据结构

每个角色包含以下字段：
- `name`: 角色名称
- `originalName`: 原名/日文名
- `image`: 角色图片URL
- `description`: 角色描述
- `anime`: 所属作品数组
- `details`: 详细信息（生日、身高、声优等）
- `source`: 数据来源（moegirl/bangumi/manual）
- `tags`: 标签数组
- `popularity`: 人气值（点击次数）
- `isActive`: 是否激活

## 🎌 角色列表

脚本会爬取以下热门动漫角色：

### 经典角色
- 鲁路修、夜神月、初音未来、江户川柯南、孙悟空、路飞

### 热门新番
- 鬼灭之刃：灶门炭治郎、我妻善逸、嘴平伊之助、灶门祢豆子
- 咒术回战：虎杖悠仁、伏黑惠、钉崎野蔷薇、五条悟
- 我的英雄学院：绿谷出久、爆豪胜己、丽日御茶子、轰焦冻

### 经典动漫
- 火影忍者、死神、全职猎人、进击的巨人、新世纪福音战士

### 日常系
- 我的青春恋爱物语果然有问题、请问您今天要来点兔子吗、轻音少女

### 其他类型
- Re:Zero、约会大作战、魔法少女小圆、东京喰种、一拳超人

总计70+个热门角色！

## ⚙️ 配置说明

### 环境变量
确保 `.env` 文件中配置了：
```env
MONGODB_URI=你的MongoDB连接字符串
```

### 数据库
- 使用MongoDB存储角色数据
- 自动创建索引优化查询性能
- 支持全文搜索

## 🔧 技术特性

### 爬取特性
- 智能解析萌娘百科页面结构
- 自动提取角色图片、描述、详细信息
- 支持多种信息框格式
- 自动生成标签和人气值

### 数据库特性
- MongoDB存储，云端同步
- 自动索引优化
- 支持聚合查询和全文搜索
- 人气值统计

### API特性
- 快速随机角色获取
- 热门角色排行
- 全文搜索功能
- 自动人气值增长

## 📈 优势

相比实时爬取：
- ⚡ **速度快**: 直接从数据库读取，无网络延迟
- 🛡️ **稳定性**: 不受目标网站限制影响
- 📊 **功能丰富**: 支持搜索、排序、统计
- 🔄 **可扩展**: 可以手动添加更多角色

## 🔄 数据更新

如需更新角色数据：
1. 编辑 `scripts/crawl-characters.js` 中的角色列表
2. 运行 `npm run crawl-characters`
3. 脚本会自动跳过已存在的角色

## 🐛 故障处理

如果爬取失败：
1. 检查网络连接
2. 检查萌娘百科是否可访问
3. 查看控制台错误信息
4. 可以重新运行脚本，已爬取的数据会保留